<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Access-Control-Allow-Origin:*" content="text/html; charset=utf-8" />
    <title>World Economy</title>
    <!-- 引入 echarts.js -->
    <script src="./static/js/echarts.js"></script>
    <script src="./static/js/world.js"></script>
    <link rel="stylesheet" href="./static/css/main.css">  
    <script type="text/javascript" src="./static/js/jquery-3.4.1.min.js"></script> 

    <!-- multiple-select.js -->
    <link rel="stylesheet" href="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.css">
    <script src="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.js"></script>
</head>

<body>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <div id="filter" style="width: 330px;">
        <!-- <select id="countries" class="j-chosen" data-live-search="true" multiple="multiple"></select> -->
        <select id="countries" data-placeholder="Choose a Country..." multiple="multiple="></select>
    </div>
    <div class="left">
        <div id="main" style='height:600px'></div>
        <div id='statisticP'>
            <div class="layer barchart">
                <div class="layerTitle">
                    <i class="arrow" onclick="hideAndShow(this)"></i>进出口差值与GDP比值
                </div>
                <div class=" sencondLayer inputSlider">
                    <div id="barchart" style="width:100%;height:300px;"></div>
                </div>
            </div>
            <div class="layer parallel">
                <div class="layerTitle">
                    <i class="arrow" onclick="hideAndShow(this)"></i>产品进/出口量
                </div>
                <div class=" sencondLayer inputSlider">
                    <div id="parallel" style="width:100%;height:300px;"></div>
                </div>
            </div>

            <div class="layer BubbleChart">
                <div class="layerTitle">
                    <i class="arrow" onclick="hideAndShow(this)"></i>人均GDP、人口、基尼指数
                </div>
                <div class=" sencondLayer inputSlider">
                    <div id="BubbleChart" style="width:100%; height:600px;border: 1px solid #ccc;"></div>
                </div>
            </div>
        </div>
    </div>
    <div class='right'>
        <div id = 'countryName'></div>
        <div id='Cpie' style="height:45%;width:100%;border: 1px solid #ccc;margin: 3px;"></div>
        <div id='Lchart' style="height:45%;width:100%;border: 1px solid #ccc;margin: 3px;bottom: 5px;"></div>
    </div>


</body>

<script src="./static/js/drawMap.js"></script>
<script src="./static/js/BubbleChart.js"></script>
<script src="./static/js/pie.js"></script>
<script type="text/javascript">
    initMap();
    var pathList = {}
    var GDPList = {}
    var ContinentList = null;
    function country_coord(res) {
        initMapData(res)
    }
    function Get_export(res) {
        res.forEach((r) => {
            if (pathList.hasOwnProperty(r.source)) {
                pathList[r.source].path.push({ name: r.target, value: Number(r.value) })
            }
            else {
                pathList[r.source] = { path: [{ name: r.target, value: Number(r.value) }] }
            }
        })
    }
    //各个国家的各类商品的进口数据
    //[国家名，各项的值...]
    var dataIm = null;
    //各个国家的各类商品的出口数据
    var dataEx = null;

    var balance = {}
    function WtoData_imports(res) {
        dataIm = res
    }
    function WtoData_exports(res) {
        dataEx = res
    }
    function WtoData_balance(res) {
        balance = res
    }
    function GDP_Population_gini(res) {
        GDPList = res
    }
    function Get_continent(res) {
        ContinentList = res
    }
</script>
<script src="./static/data/countries.js"></script>
<script src="./static/data/country_coord.json?callback=country_coord"></script>
<script src="./static/data/2018_export.json?callback=Get_export"></script>
<script src="./static/data/WtoData_imports.json?callback=WtoData_imports"></script>
<script src="./static/data/WtoData_exports.json?callback=WtoData_exports"></script>
<script src="./static/data/2017_trade_balance_percent_of_gdp.json?callback=WtoData_balance"></script>
<script src="./static/data/GDP_Population_gini.json?callback=GDP_Population_gini"></script>
<script src="./static/data/continent.json?callback=Get_continent"></script>
<script src="./static/js/parallel_export.js"></script>
<script>
    function hideAndShow(e) {
        // console.log(e)
        let className = e.parentNode.parentNode.classList
        if (className.contains("active")) {
            className.remove("active")
        } else {
            className.add("active")
            if (className.contains('parallel'))
                paral();
            if (className.contains('BubbleChart'))
                GDPBubbleChart();
            if (className.contains('barchart'))
                barchart();
        }
        // console.log(p)
    }
    function renderLchart(country) {
        //{ name: r.target, value: Number(r.value) }
        let path = pathList[country].path
        let top5 = []
        path.sort(function (a, b) {
            return b.value - a.value
        })
        let data = [path[4],path[3],path[2],path[1],path[0]]
        let ldata = []
        let l_label = []
        for(let k of data){
            let v = (k.value/100000000)
            ldata.push(v.toFixed(2))
            l_label.push(k.name)
        }

        let radarData = null
        for(let k of dataEx){
            if (country==k[0])
                radarData = k
        }
        let maxV = 0
        let r_data = []

        for (let k = 1; k < radarData.length; k++) {
            r_data.push(radarData[k])
            if (maxV < radarData[k])
                maxV = radarData[k]
        }
        let t = r_data[r_data.length-1]
        r_data[r_data.length-1] = r_data[r_data.length-2]
        r_data[r_data.length-2] = t
        r_data = [
            {
                value: r_data,
                name: ''
            }
        ]
        let r_label = [
            { name: '食品', max: maxV },
            { name: '燃料', max: maxV },
            { name: '铁', max: maxV },
            { name: '化学制品', max: maxV },
            { name: '机械', max: maxV },
            { name: '布料', max: maxV },
            { name: '服装', max: maxV }]
        console.log(radarData,r_data)
        pie(country,l_label,ldata,r_label,r_data)
   }
    let data = [
        { value: 335, name: '广东' },
        { value: 310, name: '江苏' },
        { value: 234, name: '广西' },
        { value: 135, name: '浙江' },
        { value: 1048, name: '黑龙江' },
        { value: 251, name: '其他' },
    ]
    let name = '中国'
    var Pchart = echarts.init(document.getElementById('Cpie'));
    var Lchart = echarts.init(document.getElementById('Lchart'));

    let rrr = renderLchart('China')
    console.log(rrr)
</script>

</html>